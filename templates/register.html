{% extends "base.html" %}

{% block title %}Register{% endblock %}

{% block content %}

<!-- FULLSCREEN BACKGROUND -->
<div class="min-h-screen bg-cover bg-center bg-no-repeat flex flex-col"
     style="background-image: url('{{ url_for('static', filename='Images/background.jpg') }}');">

    <!-- PREMIUM GLASS NAVBAR (same as index page) -->
    <nav class="w-full absolute top-0 left-0 z-50">
        <div class="w-full backdrop-blur-md bg-black/40 border-b border-white/10 shadow-lg">
            <div class="container mx-auto px-6 py-4 flex justify-between items-center">

                <!-- LOGO & TITLE -->
                <div class="flex items-center space-x-3">
                    <img src="{{ url_for('static', filename='Images/logo.jpg') }}"
                         class="h-10 w-10 rounded-lg border border-white/40 shadow-md" />

                    <div>
                        <h1 class="text-lg font-bold text-white drop-shadow">
                            AI Interview System
                        </h1>
                        <p class="text-xs text-white/80 drop-shadow">
                            Interview Evaluation System
                        </p>
                    </div>
                </div>

                <!-- NAV LINK -->
                <a href="{{ url_for('login') }}"
                   class="bg-white/90 text-blue-700 font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-white transition text-sm">
                    Sign In
                </a>
            </div>
        </div>
    </nav>

    <!-- MAIN FORM CARD -->
    <div class="flex-grow flex items-center justify-center px-4 pt-20">

        <div class="w-full max-w-lg p-8 rounded-2xl bg-white/20 backdrop-blur-xl border border-white/30 shadow-2xl">

            <!-- TABS -->
            <div class="flex border-b border-white/40 mb-6">
                <a href="{{ url_for('login') }}"
                   class="flex-1 py-3 text-center font-semibold text-white/70 hover:text-white/90">
                   Student Login
                </a>

                <button id="register-tab"
                        class="flex-1 py-3 text-center font-semibold text-white border-b-2 border-blue-300">
                    Register
                </button>
            </div>

            <!-- Message Area -->
            <div id="message-area" class="mb-4 hidden"></div>

            <!-- FORM -->
            <form id="register-form" class="space-y-5">

                <h2 class="text-3xl font-bold text-white mb-1">Create Account</h2>
                <p class="text-white/80 mb-6">Register as a new student.</p>

                <div class="grid grid-cols-2 gap-4">

                    <div>
                        <label class="text-white text-sm mb-1 block">First Name</label>
                        <input type="text" id="first_name" required
                               class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none"
                               placeholder="Your First Name">
                    </div>

                    <div>
                        <label class="text-white text-sm mb-1 block">Last Name</label>
                        <input type="text" id="last_name" required
                               class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none"
                               placeholder="Your Last Name">
                    </div>

                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">PRN</label>
                    <input type="text" id="prn" required
                           class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none"
                           placeholder="Enter your PRN">
                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">Institute</label>
                    <select id="institute" required
                            class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none">
                        <option disabled selected>Select your institute</option>
                        {% for inst in institutes %}
                        <option value="{{ inst }}">{{ inst }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">Department</label>
                    <select id="department" required
                            class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none">
                        <option disabled selected>Select your department</option>
                        {% for dept in departments %}
                        <option value="{{ dept }}">{{ dept }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">Email</label>
                    <input type="email" id="email" required
                           class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none"
                           placeholder="john.doe@ncer.com">
                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">Password</label>
                    <input type="password" id="password" required
                           class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none"
                           placeholder="Minimum 8 characters">
                </div>

                <div>
                    <label class="text-white text-sm mb-1 block">Confirm Password</label>
                    <input type="password" id="confirm_password" required
                           class="w-full px-4 py-3 rounded-xl bg-white/70 focus:bg-white text-gray-900 shadow outline-none">
                </div>

                <button type="submit"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-xl shadow-lg transition">
                    <span id="register-text">Register Account</span>
                    <i id="loading-spinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </form>

        </div>
    </div>
</div>

<!-- SCRIPT -->
<script>
document.getElementById('register-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const first_name = document.getElementById('first_name').value;
    const last_name = document.getElementById('last_name').value;
    const email = document.getElementById('email').value;
    const prn = document.getElementById('prn').value;
    const institute = document.getElementById('institute').value;
    const department = document.getElementById('department').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm_password').value;

    const messageArea = document.getElementById('message-area');
    const registerText = document.getElementById('register-text');
    const spinner = document.getElementById('loading-spinner');

    messageArea.classList.add('hidden');

    if (password !== confirmPassword) {
        messageArea.innerHTML = `<div class='alert-error'>Passwords do not match!</div>`;
        messageArea.classList.remove('hidden');
        return;
    }

    registerText.textContent = 'Registering...';
    spinner.classList.remove('hidden');

    try {
        const response = await fetch('{{ url_for("register") }}', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ first_name, last_name, email, prn, institute, department, password })
        });

        const data = await response.json();

        if (response.ok && data.success) {
            messageArea.innerHTML = `<div class='alert-success'>Registration successful! Redirecting...</div>`;
            messageArea.classList.remove('hidden');

            setTimeout(() => window.location.href = '{{ url_for("login") }}', 1800);
        } else {
            messageArea.innerHTML = `<div class='alert-error'>${data.message || "Something went wrong."}</div>`;
            messageArea.classList.remove('hidden');
        }

    } catch (err) {
        messageArea.innerHTML = `<div class='alert-error'>Network error. Try again.</div>`;
        messageArea.classList.remove('hidden');
    }

    registerText.textContent = 'Register Account';
    spinner.classList.add('hidden');
});
</script>

{% endblock %}
